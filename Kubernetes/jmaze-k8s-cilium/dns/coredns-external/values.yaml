replicaCount: 3

serviceType: LoadBalancer
service:
  # clusterIP: ""
  # clusterIPs: []
  loadBalancerIP: "10.50.25.10"
  # loadBalancerClass: ""
  # externalIPs: []
  # externalTrafficPolicy: ""
  # ipFamilyPolicy: ""
  # trafficDistribution: PreferClose
  # The name of the Service
  # If not set, a name is generated using the fullname template
  name: "coredns-external"
  annotations: {}
  # Pod selector
  selector: {}

# isClusterService specifies whether chart should be deployed as cluster-service or normal k8s app.
isClusterService: false

# Default zone is what Kubernetes recommends:
# https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/#coredns-configmap-options
servers:
  - zones:
      - zone: .
    port: 53
    # -- expose the service on a different port
    # servicePort: 5353
    # If serviceType is nodePort you can specify nodePort here
    # nodePort: 30053
    # hostPort: 53
    plugins:
      - name: errors
      # Serves a /health endpoint on :8080, required for livenessProbe
      - name: health
        configBlock: |-
          lameduck 10s
      # Serves a /ready endpoint on :8181, required for readinessProbe
      - name: ready
      - name: route53
        parameters: julianmaze.com.:Z0407921W5XGEPSJT29J
        configBlock: |-
          credentials default /.aws/credentials/credentials
      - name: route53
        parameters: jmaz.tv.:Z02821373MJSHO8NCPJDZ
        configBlock: |-
          credentials default /.aws/credentials/credentials
      - name: forward
        parameters: . tls://45.90.28.221 tls://45.90.30.221
        configBlock: |-
          tls_servername jmaze--k8s--cilium-7d2918.dns.nextdns.io
      - name: cache
      - name: loop
      - name: reload
      - name: loadbalance

# Complete example with all the options:
# - zones:                 # the `zones` block can be left out entirely, defaults to "."
#   - zone: hello.world.   # optional, defaults to "."
#     scheme: tls://       # optional, defaults to "" (which equals "dns://" in CoreDNS)
#   - zone: foo.bar.
#     scheme: dns://
#     use_tcp: true        # set this parameter to optionally expose the port on tcp as well as udp for the DNS protocol
#                          # Note that this will not work if you are also exposing tls or grpc on the same server
#   port: 12345            # optional, defaults to "" (which equals 53 in CoreDNS)
#   plugins:               # the plugins to use for this server block
#   - name: kubernetes     # name of plugin, if used multiple times ensure that the plugin supports it!
#     parameters: foo bar  # list of parameters after the plugin
#     configBlock: |-      # if the plugin supports extra block style config, supply it here
#       hello world
#       foo bar

# optional array of secrets to mount inside coredns container
# possible usecase: need for secure connection with etcd backend
extraSecrets:
  - name: external-dns
    mountPath: /.aws/credentials
    defaultMode: 420

## Configue a cluster-proportional-autoscaler for coredns
# See https://github.com/kubernetes-incubator/cluster-proportional-autoscaler
autoscaler:
  # Enabled the cluster-proportional-autoscaler
  enabled: true

  # Number of nodes in the cluster per coredns replica
  nodesPerReplica: 1
  # Min size of replicaCount
  min: 1
  # Max size of replicaCount (default of 0 is no max)
  max: 0
  # Whether to include unschedulable nodes in the nodes/cores calculations - this requires version 1.8.0+ of the autoscaler
  includeUnschedulableNodes: false
  # If true does not allow single points of failure to form
  preventSinglePointFailure: true
